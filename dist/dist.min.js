function Animador(t,i){this.context=t,this.ligado=!1,this.colisor=i,this.sprites=[],this.spriteExcluir=[],this.processamentos=[],this.processamentosExcluir=[]}function Bola(t,i,s,o,e){this.context=t,this.x=i,this.y=s,this.r=o,this.cor=e,this.vx=3,this.vy=2}function Colisor(){this.sprites=[],this.aoColidir=null,this.spritesExcluir=[]}function Fundo(t,i,s){this.context=t,this.imagem=i,this.velocidade=s=s,this.posicaoEmenda=0}function Nave(t,i,s,o,e,a){this.context=t,this.teclado=i,this.imagem=s,this.animador={},this.x=o,this.y=e,this.velocidade=a}function Ovni(t,i){this.context=t,this.imagem=i,this.x=0,this.y=0,this.velocidade=0}function Teclado(t){var i=this;i.elemento=t,i.pressionadas=[],i.disparadas=[],i.funcoesDisparo=[],t.addEventListener("keydown",function(t){var s=t.keyCode;i.pressionadas[s]=!0,i.funcoesDisparo[s]&&!i.disparadas[s]&&(i.disparadas[s]=!0,i.funcoesDisparo[s]())}),t.addEventListener("keyup",function(t){var s=t.keyCode;i.pressionadas[s]=!1,i.disparadas[s]=!1})}function Tiro(t,i,s){this.context=t,this.nave=i,this.largura=4,this.altura=20,this.x=i.x+i.imagem.width/2-this.largura/2,this.y=i.y-this.altura,this.velocidade=10,this.cor=s}Animador.prototype={novoSprite:function(t){this.sprites.push(t),t.animador=this},novoProcessamento:function(t){this.processamentos.push(t),t.animador=this},ligar:function(){this.ligado=!0,this.proximoFrame()},desligar:function(){this.ligado=!1},proximoFrame:function(){if(this.ligado){for(var t=this,i=0,s=this.sprites.length,o=this.processamentos.length;s>i;i++)t.sprites[i].atualizar();for(i=0;s>i;i++)t.sprites[i].desenhar();for(i=0;o>i;i++)t.processamentos[i].processar();t.processarExclusoes(),requestAnimationFrame(function(){t.proximoFrame()})}},limparTela:function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},excluirSprite:function(t){this.spriteExcluir.push(t)},excluirProcessamento:function(t){this.excluirProcessamento.push(t)},processarExclusoes:function(){for(var t=[],i=[],s=0,o=this.sprites.length,e=this.processamentos.length;o>s;s++)-1==this.spriteExcluir.indexOf(this.sprites[s])&&t.push(this.sprites[s]);for(s=0;e>s;s++)-1==this.processamentosExcluir.indexOf(this.processamentos[s])&&i.push(this.processamentos[s]);this.spriteExcluir=[],this.processamentosExcluir=[],this.sprites=t,this.processamentos=i}},function(){window.onload=function(){function t(){h++,h===l&&i()}function i(){var t=document.getElementById("myCanvas").getContext("2d"),i=new Teclado(document),n=new Colisor,h=new Animador(t,n);h.novoProcessamento(n);var l=new Fundo(t,o,3),c=new Fundo(t,e,7),u=new Fundo(t,a,10),d=new Nave(t,i,r,100,100,10);h.novoSprite(l),h.novoSprite(c),h.novoSprite(u),n.novoSprite(d),h.novoSprite(d),h.ligar(),setInterval(function(){s(t,h,n)},1e3)}function s(t,i,s){var o=new Ovni(t,n,0,0,0);o.x=Math.floor(Math.random()*(t.canvas.width-n.width+1)),o.y=n.height,o.velocidade=Math.floor(10*Math.random())+1,s.novoSprite(o),i.novoSprite(o)}var o=new Image;o.src="images/fundo-espaco.png";var e=new Image;e.src="images/fundo-estrelas.png";var a=new Image;a.src="images/fundo-nuvens.png";var r=new Image;r.src="images/nave.png";var n=new Image;n.src="images/ovni.png";var h=0,l=5;o.onload=t,e.onload=t,a.onload=t,r.onload=t,n.onload=t}}(),Bola.prototype={atualizar:function(){var t=this,i=this.context.canvas.width,s=this.context.canvas.height;(t.x<t.r||t.x>i-t.r)&&(t.vx*=-1),(t.y<t.r||t.y>s-t.r)&&(t.vy*=-1),t.x+=t.vx,t.y+=t.vy},desenhar:function(){var t=this.context,i=this;t.save(),t.fillStyle=this.cor,t.beginPath(),t.arc(i.x,i.y,i.r,0,2*Math.PI,!1),t.fill(),t.restore()},retangulosColisao:function(){var t=this;return console.log(t.x),[{x:t.x-t.r,y:t.y-t.r,largura:2*t.r,altura:2*t.r}]},colidiuCom:function(t){this.vx*=-1,this.vy*=-1}},Colisor.prototype={novoSprite:function(t){t.colisor=this,this.sprites.push(t)},processar:function(){for(var t={},i=this.sprites.length,s=0,o=0;i>s;s++)for(;i>o;o++)if(s!==o){var e=this.stringUnica(),a=this.stringUnica();t[e]||(t[e]=[]),t[a]||(t[a]=[]),t[e].indexOf(a)>0||t[a].indexOf(e)>0||(this.testarColisao(this.sprites[s],this.sprites[o]),t[e].push(a),t[a].push(e))}this.processarExclusoes()},stringUnica:function(){var t=Math.floor(1e3*Math.random()+1);return"Retangulo"+t},testarColisao:function(t,i){var s=t.retangulosColisao(),o=i.retangulosColisao(),e=0,a=0,r=s.length,n=o.length;t:for(;r>e;e++)for(;n>a;a++)if(this.retangulosColidem(s[e],o[a])){t.colidiuCom(i),i.colidiuCom(t),this.aoColidir&&this.aoColidir(t,i);break t}},retangulosColidem:function(t,i){return t.x+t.largura>i.x&&t.x<i.x+i.largura&&t.y+t.altura>i.y&&t.y<i.y+i.altura},excluirSprite:function(t){this.spritesExcluir.push(t)},processarExclusoes:function(){for(var t=[],i=0,s=this.sprites.length;s>i;i++)-1==this.spritesExcluir.indexOf(this.sprites[i])&&t.push(this.sprites[i]);this.spritesExcluir=[],this.sprites=t}},Fundo.prototype={atualizar:function(){this.posicaoEmenda+=this.velocidade,this.posicaoEmenda>this.imagem.height&&(this.posicaoEmenda=0)},desenhar:function(){var t=this.imagem,i=this.posicaoEmenda-t.height;this.context.drawImage(t,0,i,t.width,t.height),i=this.posicaoEmenda,this.context.drawImage(t,0,i,t.width,t.height)}},Nave.prototype={atualizar:function(){var t=this;this.teclado.pressionada(SETA_ESQUERDA)&&this.x>0&&(this.x-=this.velocidade),this.teclado.pressionada(SETA_DIREITA)&&this.x<this.context.canvas.width-this.imagem.width&&(this.x+=this.velocidade),this.teclado.pressionada(SETA_CIMA)&&this.y>0&&(this.y-=this.velocidade),this.teclado.pressionada(SETA_BAIXO)&&this.y<this.context.canvas.height-this.imagem.height&&(this.y+=this.velocidade),this.teclado.disparou(ESPACO,function(){t.atirar()})},desenhar:function(){this.context.drawImage(this.imagem,this.x,this.y,this.imagem.width,this.imagem.height),this.desenharRetangulosDeColisao()},atirar:function(){var t=new Tiro(this.context,this,"blue");this.animador.novoSprite(t),this.colisor.novoSprite(t),console.log(this.colisor)},retangulosColisao:function(){return[{x:this.x,y:this.y+18,largura:15,altura:14},{x:this.x+20,y:this.y+18,largura:15,altura:14},{x:this.x+15,y:this.y,largura:5,altura:this.imagem.height}]},desenharRetangulosDeColisao:function(){var t=this.context;t.save(),t.strokeStyle="yellow";for(var i=this.retangulosColisao(),s=0,o=i.length;o>s;s++){var e=i[s];t.strokeRect(e.x,e.y,e.largura,e.altura)}t.restore()},colidiuCom:function(t){t instanceof Ovni&&(this.animador.desligar(),alert("Fim de jogo"))}},Ovni.prototype={atualizar:function(){this.y+=this.velocidade,this.y>this.context.canvas.height&&(this.animador.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var t=this.context,i=this.imagem;t.drawImage(i,this.x,this.y,i.width,i.height),this.desenharRetangulosDeColisao()},retangulosColisao:function(){return[{x:this.x,y:this.y+10,largura:this.imagem.width,altura:this.imagem.height-20},{x:this.x+20,y:this.y,largura:28,altura:10},{x:this.x+18,y:this.y+22,largura:28,altura:10}]},desenharRetangulosDeColisao:function(){var t=this.context;t.save(),t.strokeStyle="yellow";for(var i=this.retangulosColisao(),s=0,o=i.length;o>s;s++){var e=i[s];t.strokeRect(e.x,e.y,e.largura,e.altura)}t.restore()},colidiuCom:function(t){console.log(t),t instanceof Tiro&&(console.log("tiro"),this.animador.excluirSprite(this),this.colisor.excluirSprite(this),this.animador.excluirSprite(t),this.colisor.excluirSprite(t))}};var SETA_ESQUERDA=37,SETA_DIREITA=39,SETA_CIMA=38,SETA_BAIXO=40,ESPACO=32;Teclado.prototype={pressionada:function(t){return this.pressionadas[t]},disparou:function(t,i){this.funcoesDisparo[t]=i}},Tiro.prototype={atualizar:function(){this.y-=this.velocidade,this.y<0&&(this.animador.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var t=this.context;t.save(),t.fillStyle=this.cor,t.fillRect(this.x,this.y,this.largura,this.altura),t.restore(),this.desenharRetangulosDeColisao()},retangulosColisao:function(){return[{x:this.x,y:this.y,largura:this.largura,altura:this.altura}]},desenharRetangulosDeColisao:function(){var t=this.context;t.save(),t.strokeStyle="yellow";for(var i=this.retangulosColisao(),s=0,o=i.length;o>s;s++){var e=i[s];t.strokeRect(e.x,e.y,e.largura,e.altura)}t.restore()},colidiuCom:function(t){console.log("pow")}};