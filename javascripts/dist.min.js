<<<<<<< HEAD
function Animador(i){this.context=i,this.ligado=!1,this.sprites=[],this.spriteExcluir=[],this.processamentos=[],this.processamentosExcluir=[],this.ultimoCiclo=0,this.decorrido=0}function Bola(i,t,s,o,e){this.context=i,this.x=t,this.y=s,this.r=o,this.cor=e,this.vx=3,this.vy=2}function Colisor(){this.sprites=[],this.aoColidir=null,this.spritesExcluir=[]}function Explosao(i,t,s,o){this.context=i,this.imagem=t,this.x=s,this.y=o,this.spritesheet=new Spritesheet(i,t,1,5),this.spritesheet.intervalo=75;var e=this;this.spritesheet.fimDoCiclo=function(){e.animador.excluirSprite(e)}}function Fundo(i,t,s){this.context=i,this.imagem=t,this.velocidade=s=s,this.posicaoEmenda=0}function Nave(i,t,s,o,e,a){this.context=i,this.teclado=t,this.imagem=s,this.animador={},this.x=o,this.y=e,this.velocidade=a,this.spriteSheet=new Spritesheet(i,s,3,2),this.spriteSheet.linha=0,this.spriteSheet.intervalo=100}function Ovni(i,t,s){this.context=i,this.imagem=t,this.x=0,this.y=0,this.velocidade=0,this.imgExplosao=s}function Spritesheet(i,t,s,o){this.context=i,this.imagem=t,this.numLinhas=s,this.numColunas=o,this.intervalo=0,this.linha=0,this.coluna=0,this.fimDoCiclo=null}function Teclado(i){var t=this;t.elemento=i,t.pressionadas=[],t.disparadas=[],t.funcoesDisparo=[],i.addEventListener("keydown",function(i){var s=i.keyCode;t.pressionadas[s]=!0,t.funcoesDisparo[s]&&!t.disparadas[s]&&(t.disparadas[s]=!0,t.funcoesDisparo[s]())}),i.addEventListener("keyup",function(i){var s=i.keyCode;t.pressionadas[s]=!1,t.disparadas[s]=!1})}function Tiro(i,t,s){this.context=i,this.nave=t,this.largura=4,this.altura=20,this.x=t.x+18,this.y=t.y-this.altura,this.velocidade=600,this.cor=s}Animador.prototype={novoSprite:function(i){this.sprites.push(i),i.animador=this},novoProcessamento:function(i){this.processamentos.push(i),i.animador=this},ligar:function(){this.ligado=!0,this.proximoFrame()},desligar:function(){this.ligado=!1},proximoFrame:function(){if(this.ligado){var i=(new Date).getTime();0===this.ultimoCiclo&&(this.ultimoCiclo=i),this.decorrido=i-this.ultimoCiclo;for(var t=this,s=0,o=this.sprites.length,e=this.processamentos.length;o>s;s++)t.sprites[s].atualizar();for(s=0;o>s;s++)t.sprites[s].desenhar();for(s=0;e>s;s++)t.processamentos[s].processar();t.processarExclusoes(),this.ultimoCiclo=i,requestAnimationFrame(function(){t.proximoFrame()})}},limparTela:function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},excluirSprite:function(i){this.spriteExcluir.push(i)},excluirProcessamento:function(i){this.excluirProcessamento.push(i)},processarExclusoes:function(){for(var i=[],t=[],s=0,o=this.sprites.length,e=this.processamentos.length;o>s;s++)-1==this.spriteExcluir.indexOf(this.sprites[s])&&i.push(this.sprites[s]);for(s=0;e>s;s++)-1==this.processamentosExcluir.indexOf(this.processamentos[s])&&t.push(this.processamentos[s]);this.spriteExcluir=[],this.processamentosExcluir=[],this.sprites=i,this.processamentos=t}},function(){window.onload=function(){function i(){n={espaco:"fundo-espaco.png",estrelas:"fundo-estrelas.png",nuvens:"fundo-estrelas.png",nave:"nave-spritesheet.png",ovni:"ovni.png",explosao:"explosao.png"};for(var i in n){var s=new Image;s.src="images/"+n[i],s.onload=t,n[i]=s,x++}}function t(){v++,v===x&&s()}function s(){h=new Animador(r),l=new Teclado(document),c=new Colisor,d=new Fundo(r,n.espaco,60),p=new Fundo(r,n.estrelas,150),u=new Fundo(r,n.nuvens,500),m=new Nave(r,l,n.nave,a.width/2-18,a.height-48,250),h.novoSprite(d),h.novoSprite(p),h.novoSprite(u),h.novoSprite(m),c.novoSprite(m),h.novoProcessamento(c),o(),h.ligar()}function o(){criadorInimigos={ultimoOvni:(new Date).getTime(),processar:function(){var i=(new Date).getTime(),t=i-this.ultimoOvni;t>1e3&&(e(),this.ultimoOvni=i)}},h.novoProcessamento(criadorInimigos)}function e(){var i=new Ovni(r,n.ovni,n.explosao);i.x=Math.floor(Math.random()*(r.canvas.width-n.ovni.width+1)),i.y=n.ovni.height,i.velocidade=Math.floor(500*Math.random())+150,c.novoSprite(i),h.novoSprite(i)}var a=document.getElementById("myCanvas"),r=a.getContext("2d"),n=[],h={},l={},c={},u={},p={},d={},m={},x=0,v=0;i()}}(),Bola.prototype={atualizar:function(){var i=this,t=this.context.canvas.width,s=this.context.canvas.height;(i.x<i.r||i.x>t-i.r)&&(i.vx*=-1),(i.y<i.r||i.y>s-i.r)&&(i.vy*=-1),i.x+=i.vx,i.y+=i.vy},desenhar:function(){var i=this.context,t=this;i.save(),i.fillStyle=this.cor,i.beginPath(),i.arc(t.x,t.y,t.r,0,2*Math.PI,!1),i.fill(),i.restore()},retangulosColisao:function(){var i=this;return console.log(i.x),[{x:i.x-i.r,y:i.y-i.r,largura:2*i.r,altura:2*i.r}]},colidiuCom:function(i){this.vx*=-1,this.vy*=-1}},Colisor.prototype={novoSprite:function(i){this.sprites.push(i),i.colisor=this},processar:function(){var i={};for(var t in this.sprites)for(var s in this.sprites)if(t!=s){var o=this.stringUnica(this.sprites[t]),e=this.stringUnica(this.sprites[s]);i[o]||(i[o]=[]),i[e]||(i[e]=[]),i[o].indexOf(e)>=0||i[e].indexOf(o)>=0||(this.testarColisao(this.sprites[t],this.sprites[s]),i[o].push(e),i[e].push(o))}this.processarExclusoes()},testarColisao:function(i,t){var s=i.retangulosColisao(),o=t.retangulosColisao();i:for(var e in s)for(var a in o)if(this.retangulosColidem(s[e],o[a])){i.colidiuCom(t),t.colidiuCom(i),this.aoColidir&&this.aoColidir(i,t);break i}},retangulosColidem:function(i,t){return i.x+i.largura>t.x&&i.x<t.x+t.largura&&i.y+i.altura>t.y&&i.y<t.y+t.altura},stringUnica:function(i){var t="",s=i.retangulosColisao();for(var o in s)t+="x:"+s[o].x+",y:"+s[o].y+",l:"+s[o].largura+",a:"+s[o].altura+"\n";return t},excluirSprite:function(i){this.spritesExcluir.push(i)},processarExclusoes:function(){var i=[];for(var t in this.sprites)-1==this.spritesExcluir.indexOf(this.sprites[t])&&i.push(this.sprites[t]);this.spritesExcluir=[],this.sprites=i}},Explosao.prototype={atualizar:function(){},desenhar:function(){this.spritesheet.desenhar(this.x,this.y),this.spritesheet.proximoQuadro()}},Fundo.prototype={atualizar:function(){this.posicaoEmenda+=this.velocidade*this.animador.decorrido/1e3,this.posicaoEmenda>this.imagem.height&&(this.posicaoEmenda=0)},desenhar:function(){var i=this.imagem,t=this.posicaoEmenda-i.height;this.context.drawImage(i,0,t,i.width,i.height),t=this.posicaoEmenda,this.context.drawImage(i,0,t,i.width,i.height)}},Nave.prototype={atualizar:function(){var i=this,t=this.velocidade*this.animador.decorrido/1e3;this.teclado.pressionada(SETA_ESQUERDA)&&this.x>0&&(this.x-=t),this.teclado.pressionada(SETA_DIREITA)&&this.x<this.context.canvas.width-36&&(this.x+=t),this.teclado.pressionada(SETA_CIMA)&&this.y>0&&(this.y-=t),this.teclado.pressionada(SETA_BAIXO)&&this.y<this.context.canvas.height-48&&(this.y+=t),this.teclado.disparou(ESPACO,function(){i.atirar()})},desenhar:function(){this.teclado.pressionada(SETA_ESQUERDA)?this.spriteSheet.linha=1:this.teclado.pressionada(SETA_DIREITA)?this.spriteSheet.linha=2:this.spriteSheet.linha=0,this.spriteSheet.desenhar(this.x,this.y),this.spriteSheet.proximoQuadro()},atirar:function(){var i=new Tiro(this.context,this,"blue");this.animador.novoSprite(i),this.colisor.novoSprite(i)},retangulosColisao:function(){return[{x:this.x,y:this.y+18,largura:15,altura:14},{x:this.x+20,y:this.y+18,largura:15,altura:14},{x:this.x+15,y:this.y,largura:5,altura:48}]},desenharRetangulosDeColisao:function(){var i=this.context;i.save(),i.strokeStyle="yellow";for(var t=this.retangulosColisao(),s=0,o=t.length;o>s;s++){var e=t[s];i.strokeRect(e.x,e.y,e.largura,e.altura)}i.restore()},colidiuCom:function(i){}},Ovni.prototype={atualizar:function(){this.y+=this.velocidade*this.animador.decorrido/1e3,this.y>this.context.canvas.height&&(this.animador.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var i=this.context,t=this.imagem;i.drawImage(t,this.x,this.y,t.width,t.height)},retangulosColisao:function(){return[{x:this.x,y:this.y+10,largura:this.imagem.width,altura:this.imagem.height-20},{x:this.x+20,y:this.y,largura:28,altura:10},{x:this.x+18,y:this.y+22,largura:28,altura:10}]},desenharRetangulosDeColisao:function(){var i=this.context;i.save(),i.strokeStyle="yellow";for(var t=this.retangulosColisao(),s=0,o=t.length;o>s;s++){var e=t[s];i.strokeRect(e.x,e.y,e.largura,e.altura)}i.restore()},colidiuCom:function(i){if(i instanceof Tiro){this.animador.excluirSprite(this),this.colisor.excluirSprite(this),this.animador.excluirSprite(i),this.colisor.excluirSprite(i);var t=new Explosao(this.context,this.imgExplosao,this.x,this.y);this.animador.novoSprite(t)}}},Spritesheet.prototype={proximoQuadro:function(){var i=(new Date).getTime();this.ultimoTempo||(this.ultimoTempo=i),i-this.ultimoTempo<this.intervalo||(this.coluna<this.numColunas-1?this.coluna++:(this.coluna=0,this.fimDoCiclo&&this.fimDoCiclo()),this.ultimoTempo=i)},desenhar:function(i,t){var s=this.imagem.width/this.numColunas,o=this.imagem.height/this.numLinhas;this.context.drawImage(this.imagem,s*this.coluna,o*this.linha,s,o,i,t,s,o)}};var SETA_ESQUERDA=37,SETA_DIREITA=39,SETA_CIMA=38,SETA_BAIXO=40,ESPACO=32;Teclado.prototype={pressionada:function(i){return this.pressionadas[i]},disparou:function(i,t){this.funcoesDisparo[i]=t}},Tiro.prototype={atualizar:function(){this.y-=this.velocidade*this.animador.decorrido/1e3,this.y<0&&(this.animador.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var i=this.context;i.save(),i.fillStyle=this.cor,i.fillRect(this.x,this.y,this.largura,this.altura),i.restore()},retangulosColisao:function(){return[{x:this.x,y:this.y,largura:this.largura,altura:this.altura}]},desenharRetangulosDeColisao:function(){var i=this.context;i.save(),i.strokeStyle="yellow";for(var t=this.retangulosColisao(),s=0,o=t.length;o>s;s++){var e=t[s];i.strokeRect(e.x,e.y,e.largura,e.altura)}i.restore()},colidiuCom:function(i){}};
=======
function Animador(i,t){this.context=i,this.ligado=!1,this.colisor=t,this.sprites=[],this.spriteExcluir=[],this.processamentos=[],this.processamentosExcluir=[]}function Bola(i,t,s,o,a){this.context=i,this.x=t,this.y=s,this.r=o,this.cor=a,this.vx=3,this.vy=2}function Colisor(){this.sprites=[],this.aoColidir=null,this.spritesExcluir=[]}function Fundo(i,t,s){this.context=i,this.imagem=t,this.velocidade=s=s,this.posicaoEmenda=0}function Nave(i,t,s,o,a,e){this.context=i,this.teclado=t,this.imagem=s,this.animador={},this.x=o,this.y=a,this.velocidade=e}function Ovni(i,t){this.context=i,this.imagem=t,this.x=0,this.y=0,this.velocidade=0}function Teclado(i){var t=this;t.elemento=i,t.pressionadas=[],t.disparadas=[],t.funcoesDisparo=[],i.addEventListener("keydown",function(i){var s=i.keyCode;t.pressionadas[s]=!0,t.funcoesDisparo[s]&&!t.disparadas[s]&&(t.disparadas[s]=!0,t.funcoesDisparo[s]())}),i.addEventListener("keyup",function(i){var s=i.keyCode;t.pressionadas[s]=!1,t.disparadas[s]=!1})}function Tiro(i,t,s){this.context=i,this.nave=t,this.largura=4,this.altura=20,this.x=t.x+t.imagem.width/2-this.largura/2,this.y=t.y-this.altura,this.velocidade=10,this.cor=s}Animador.prototype={novoSprite:function(i){this.sprites.push(i),i.animador=this},novoProcessamento:function(i){this.processamentos.push(i),i.animador=this},ligar:function(){this.ligado=!0,this.proximoFrame()},desligar:function(){this.ligado=!1},proximoFrame:function(){if(this.ligado){for(var i=this,t=0,s=this.sprites.length,o=this.processamentos.length;s>t;t++)i.sprites[t].atualizar();for(t=0;s>t;t++)i.sprites[t].desenhar();for(t=0;o>t;t++)i.processamentos[t].processar();i.processarExclusoes(),requestAnimationFrame(function(){i.proximoFrame()})}},limparTela:function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},excluirSprite:function(i){this.spriteExcluir.push(i)},excluirProcessamento:function(i){this.excluirProcessamento.push(i)},processarExclusoes:function(){for(var i=[],t=[],s=0,o=this.sprites.length,a=this.processamentos.length;o>s;s++)-1==this.spriteExcluir.indexOf(this.sprites[s])&&i.push(this.sprites[s]);for(s=0;a>s;s++)-1==this.processamentosExcluir.indexOf(this.processamentos[s])&&t.push(this.processamentos[s]);this.spriteExcluir=[],this.processamentosExcluir=[],this.sprites=i,this.processamentos=t}},function(){window.onload=function(){function i(){h++,h===c&&t()}function t(){var i=document.getElementById("myCanvas").getContext("2d"),t=new Teclado(document),n=new Colisor,h=new Animador(i,n);h.novoProcessamento(n);var c=new Fundo(i,o,3),l=new Fundo(i,a,7),u=new Fundo(i,e,10),d=new Nave(i,t,r,100,100,10);h.novoSprite(c),h.novoSprite(l),h.novoSprite(u),n.novoSprite(d),h.novoSprite(d),h.ligar(),setInterval(function(){s(i,h,n)},1e3)}function s(i,t,s){var o=new Ovni(i,n,0,0,0);o.x=Math.floor(Math.random()*(i.canvas.width-n.width+1)),o.y=n.height,o.velocidade=Math.floor(10*Math.random())+1,s.novoSprite(o),t.novoSprite(o)}var o=new Image;o.src="images/fundo-espaco.png";var a=new Image;a.src="images/fundo-estrelas.png";var e=new Image;e.src="images/fundo-nuvens.png";var r=new Image;r.src="images/nave.png";var n=new Image;n.src="images/ovni.png";var h=0,c=5;o.onload=i,a.onload=i,e.onload=i,r.onload=i,n.onload=i}}(),Bola.prototype={atualizar:function(){var i=this,t=this.context.canvas.width,s=this.context.canvas.height;(i.x<i.r||i.x>t-i.r)&&(i.vx*=-1),(i.y<i.r||i.y>s-i.r)&&(i.vy*=-1),i.x+=i.vx,i.y+=i.vy},desenhar:function(){var i=this.context,t=this;i.save(),i.fillStyle=this.cor,i.beginPath(),i.arc(t.x,t.y,t.r,0,2*Math.PI,!1),i.fill(),i.restore()},retangulosColisao:function(){var i=this;return console.log(i.x),[{x:i.x-i.r,y:i.y-i.r,largura:2*i.r,altura:2*i.r}]},colidiuCom:function(i){this.vx*=-1,this.vy*=-1}},Colisor.prototype={novoSprite:function(i){this.sprites.push(i),i.colisor=this},processar:function(){var i=new Object;for(var t in this.sprites)for(var s in this.sprites)if(t!=s){var o=this.stringUnica(this.sprites[t]),a=this.stringUnica(this.sprites[s]);i[o]||(i[o]=[]),i[a]||(i[a]=[]),i[o].indexOf(a)>=0||i[a].indexOf(o)>=0||(this.testarColisao(this.sprites[t],this.sprites[s]),i[o].push(a),i[a].push(o))}this.processarExclusoes()},testarColisao:function(i,t){var s=i.retangulosColisao(),o=t.retangulosColisao();i:for(var a in s)for(var e in o)if(this.retangulosColidem(s[a],o[e])){i.colidiuCom(t),t.colidiuCom(i),this.aoColidir&&this.aoColidir(i,t);break i}},retangulosColidem:function(i,t){return i.x+i.largura>t.x&&i.x<t.x+t.largura&&i.y+i.altura>t.y&&i.y<t.y+t.altura},stringUnica:function(i){var t="",s=i.retangulosColisao();for(var o in s)t+="x:"+s[o].x+",y:"+s[o].y+",l:"+s[o].largura+",a:"+s[o].altura+"\n";return t},excluirSprite:function(i){this.spritesExcluir.push(i)},processarExclusoes:function(){var i=[];for(var t in this.sprites)-1==this.spritesExcluir.indexOf(this.sprites[t])&&i.push(this.sprites[t]);this.spritesExcluir=[],this.sprites=i}},Fundo.prototype={atualizar:function(){this.posicaoEmenda+=this.velocidade,this.posicaoEmenda>this.imagem.height&&(this.posicaoEmenda=0)},desenhar:function(){var i=this.imagem,t=this.posicaoEmenda-i.height;this.context.drawImage(i,0,t,i.width,i.height),t=this.posicaoEmenda,this.context.drawImage(i,0,t,i.width,i.height)}},Nave.prototype={atualizar:function(){var i=this;this.teclado.pressionada(SETA_ESQUERDA)&&this.x>0&&(this.x-=this.velocidade),this.teclado.pressionada(SETA_DIREITA)&&this.x<this.context.canvas.width-this.imagem.width&&(this.x+=this.velocidade),this.teclado.pressionada(SETA_CIMA)&&this.y>0&&(this.y-=this.velocidade),this.teclado.pressionada(SETA_BAIXO)&&this.y<this.context.canvas.height-this.imagem.height&&(this.y+=this.velocidade),this.teclado.disparou(ESPACO,function(){i.atirar()})},desenhar:function(){this.context.drawImage(this.imagem,this.x,this.y,this.imagem.width,this.imagem.height),this.desenharRetangulosDeColisao()},atirar:function(){var i=new Tiro(this.context,this,"blue");this.animador.novoSprite(i),this.colisor.novoSprite(i)},retangulosColisao:function(){return[{x:this.x,y:this.y+18,largura:15,altura:14},{x:this.x+20,y:this.y+18,largura:15,altura:14},{x:this.x+15,y:this.y,largura:5,altura:this.imagem.height}]},desenharRetangulosDeColisao:function(){var i=this.context;i.save(),i.strokeStyle="yellow";for(var t=this.retangulosColisao(),s=0,o=t.length;o>s;s++){var a=t[s];i.strokeRect(a.x,a.y,a.largura,a.altura)}i.restore()},colidiuCom:function(i){}},Ovni.prototype={atualizar:function(){this.y+=this.velocidade,this.y>this.context.canvas.height&&(this.animador.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var i=this.context,t=this.imagem;i.drawImage(t,this.x,this.y,t.width,t.height),this.desenharRetangulosDeColisao()},retangulosColisao:function(){return[{x:this.x,y:this.y+10,largura:this.imagem.width,altura:this.imagem.height-20},{x:this.x+20,y:this.y,largura:28,altura:10},{x:this.x+18,y:this.y+22,largura:28,altura:10}]},desenharRetangulosDeColisao:function(){var i=this.context;i.save(),i.strokeStyle="yellow";for(var t=this.retangulosColisao(),s=0,o=t.length;o>s;s++){var a=t[s];i.strokeRect(a.x,a.y,a.largura,a.altura)}i.restore()},colidiuCom:function(i){console.log(i),i instanceof Tiro&&(console.log("tiro"),this.animador.excluirSprite(this),this.colisor.excluirSprite(this),this.animador.excluirSprite(i),this.colisor.excluirSprite(i))}};var SETA_ESQUERDA=37,SETA_DIREITA=39,SETA_CIMA=38,SETA_BAIXO=40,ESPACO=32;Teclado.prototype={pressionada:function(i){return this.pressionadas[i]},disparou:function(i,t){this.funcoesDisparo[i]=t}},Tiro.prototype={atualizar:function(){this.y-=this.velocidade,this.y<0&&(this.animador.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var i=this.context;i.save(),i.fillStyle=this.cor,i.fillRect(this.x,this.y,this.largura,this.altura),i.restore(),this.desenharRetangulosDeColisao()},retangulosColisao:function(){return[{x:this.x,y:this.y,largura:this.largura,altura:this.altura}]},desenharRetangulosDeColisao:function(){var i=this.context;i.save(),i.strokeStyle="yellow";for(var t=this.retangulosColisao(),s=0,o=t.length;o>s;s++){var a=t[s];i.strokeRect(a.x,a.y,a.largura,a.altura)}i.restore()},colidiuCom:function(i){console.log("pow")}};
>>>>>>> 13c2c0be7f7357536a4d4120ebf24de73c92fd62
