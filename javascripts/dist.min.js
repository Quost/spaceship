function Animador(t,i){this.context=t,this.sprites=[],this.ligado=!1,this.colisor=i}function Bola(t,i,o,s,a){this.context=t,this.x=i,this.y=o,this.r=s,this.cor=a,this.vx=3,this.vy=2}function Colisor(){this.sprites=[],this.aoColidir=null}function Fundo(t,i,o){this.context=t,this.imagem=i,this.velocidade=o=o,this.posicaoEmenda=0}function Nave(t,i,o,s,a){this.context=t,this.teclado=i,this.animacao=o,this.x=s,this.y=a}function Teclado(t){var i=this;i.elemento=t,i.pressionadas=[],i.disparadas=[],i.funcoesDisparo=[],t.addEventListener("keydown",function(t){var o=t.keyCode;i.pressionadas[o]=!0,i.funcoesDisparo[o]&&!i.disparadas[o]&&(i.disparadas[o]=!0,i.funcoesDisparo[o]())}),t.addEventListener("keyup",function(t){var o=t.keyCode;i.pressionadas[o]=!1,i.disparadas[o]=!1})}Animador.prototype={novoSprite:function(t){this.sprites.push(t)},ligar:function(){this.ligado=!0,this.proximoFrame()},desligar:function(){this.ligado=!1},proximoFrame:function(){if(this.ligado){this.limparTela();for(var t=0,i=this.sprites.length;i>t;t++)this.sprites[t].atualizar();for(t=0;i>t;t++)this.sprites[t].desenhar();this.colisor.processar();var o=this;requestAnimationFrame(function(){o.proximoFrame()})}},limparTela:function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},desenharRetangulosDeColisao:function(){var t=this.context;t.save(),t.strokeStyle="yellow";for(var i=0,o=this.sprites.length;o>i;i++)for(var s=this.sprites[i].retangulosColisao(),a=0,e=s.length;e>a;a++){var n=s[a];t.strokeRect(n.x,n.y,n.largura,n.altura)}t.restore()}},function(){window.onload=function(){var t=document.getElementById("myCanvas").getContext("2d"),i=(new Teclado(document),new Bola(t,100,100,20,"red")),o=new Bola(t,50,200,30,"blue"),s=new Colisor,a=new Animador(t,s);s.novoSprite(i),s.novoSprite(o),a.novoSprite(i),a.novoSprite(o),a.ligar()}}(),Bola.prototype={atualizar:function(){var t=this,i=this.context.canvas.width,o=this.context.canvas.height;(t.x<t.r||t.x>i-t.r)&&(t.vx*=-1),(t.y<t.r||t.y>o-t.r)&&(t.vy*=-1),t.x+=t.vx,t.y+=t.vy},desenhar:function(){var t=this.context,i=this;t.save(),t.fillStyle=this.cor,t.beginPath(),t.arc(i.x,i.y,i.r,0,2*Math.PI,!1),t.fill(),t.restore()},retangulosColisao:function(){var t=this;return console.log(t.x),[{x:t.x-t.r,y:t.y-t.r,largura:2*t.r,altura:2*t.r}]},colidiuCom:function(t){this.vx*=-1,this.vy*=-1}},Colisor.prototype={novoSprite:function(t){this.sprites.push(t)},processar:function(){for(var t={},i=this.sprites.length,o=0,s=0;i>o;o++)for(;i>s;s++)if(o!==s){var a=this.stringUnica(),e=this.stringUnica();t[a]||(t[a]=[]),t[e]||(t[e]=[]),t[a].indexOf(e)>0||t[e].indexOf(a)>0||(this.testarColisao(this.sprites[o],this.sprites[s]),t[a].push(e),t[e].push(a))}},stringUnica:function(){var t=Math.floor(1e3*Math.random()+1);return"Retangulo"+t},testarColisao:function(t,i){var o=t.retangulosColisao(),s=i.retangulosColisao(),a=0,e=0,n=o.length,r=s.length;t:for(;n>a;a++)for(;r>e;e++)if(this.retangulosColidem(o[a],s[e])){t.colidiuCom(i),i.colidiuCom(t),this.aoColidir&&this.aoColidir(t,i);break t}},retangulosColidem:function(t,i){return t.x+t.largura>i.x&&t.x<i.x+i.largura&&t.y+t.altura>i.y&&t.y<i.y+i.altura}},Fundo.prototype={atualizar:function(){this.posicaoEmenda+=this.velocidade,this.posicaoEmenda>this.imagem.height&&(this.posicaoEmenda=0)},desenhar:function(){var t=this.imagem,i=this.posicaoEmenda-t.height;this.context.drawImage(t,0,i,t.width,t.height),i=this.posicaoEmenda,this.context.drawImage(t,0,i,t.width,t.height)}},Nave.prototype={atualizar:function(){this.teclado.pressionada(SETA_ESQUERDA)&&this.x>20&&(this.x-=10),this.teclado.pressionada(SETA_DIREITA)&&this.x<this.context.canvas.width-20&&(this.x+=10)},desenhar:function(){this.context.fillRect(this.x,this.y,20,50)},atirar:function(){var t=new Bola(this.context,this.x+10,this.y+10,10,"red");this.teclado.pressionada(SETA_DIREITA)?t.vx=20:t.vx=-20,this.animacao.novoSprite(t)},retangulosColisao:function(){return[{x:this.x,y:this.y,largura:this.x+20,altura:this.y+20}]},colidiuCom:function(t){console.log("colisao"),console.log(t)}};var SETA_ESQUERDA=37,SETA_DIREITA=39,ESPACO=32;Teclado.prototype={pressionada:function(t){return this.pressionadas[t]},disparou:function(t,i){this.funcoesDisparo[t]=i}};